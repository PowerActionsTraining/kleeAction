apiVersion: automation.cloudbees.io/v1alpha1
kind: workflow
name: My workflow
on:
  workflow_dispatch:
    inputs:
      pathtobinary:
        type: string
        default: example.txt
        required: true
      artifactversion:
        type: string
        default: 1.0.0
        required: true
jobs:
  build:
    steps:
      - name: Create file
        id: step1
        uses: docker://curlimages/curl:latest
        shell: sh
        run: |
          echo "This is an example file - $(date)" > ${{inputs.pathtobinary}}
          echo ${{inputs.pathtobinary}} 
          cat ${{inputs.pathtobinary}}

  Jenkins-Output-Job:
    outputs:
      jenkins_output: ${{ steps.my-output-job.outputs.jenkins_output }}
    steps:
      - id: my-output-job
        name: Run Jenkins job with output
        uses: https://github.com/cloudbees-io/jenkins-run-job@v2
        with:
          url: https://sda.preview.cb-demos.io/westest/
          username: ${{ secrets.WES_JENKINS_USERNAME }}
          token: ${{ secrets.WES_JENKINS_TOKEN }}
          job-name: WesTestJob2

      - id: expose-output
        name: Expose Jenkins job output
        uses: docker://exozet/jq:1.6-r0
        if: ${{ fromJSON(steps.my-output-job.outputs.jenkins_output).TESTVAR != '19' }}
        run: |
          echo "BUILD_NUMBER: ${{ fromJSON(steps.my-output-job.outputs.jenkins_output).BUILD_NUMBER }}"
          echo "TESTVAR: ${{ fromJSON(steps.my-output-job.outputs.jenkins_output).status }}"

  Print-Jenkins-Outputs:
    if: ${{ fromJSON(needs.Jenkins-Output-Job.outputs.jenkins_output).status == 'success' }}
    needs: [Jenkins-Output-Job]
    steps:
      - id: print-jenkins-output
        uses: docker://exozet/jq:1.6-r0
        name: Print Jenkins-Output-Job outputs
        run: |
          echo "BUILD_NUMBER: ${{ fromJSON(needs.Jenkins-Output-Job.outputs.jenkins_output).BUILD_NUMBER }}"

